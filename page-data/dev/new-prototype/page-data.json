{"componentChunkName":"component---src-templates-blog-post-js","path":"/dev/new-prototype/","result":{"data":{"site":{"siteMetadata":{"title":"bestalign's dev blog","categories":[{"displayText":"홈","priority":0,"name":"home","url":"/"},{"displayText":"TIL","priority":1,"name":"til","url":"/til"},{"displayText":"개발","priority":2,"name":"dev","url":"/dev"},{"displayText":"독서","priority":3,"name":"reading","url":"/reading"},{"displayText":"번역","priority":4,"name":"translation","url":"/translation"},{"displayText":"일기","priority":5,"name":"everydaylife","url":"/everydaylife"}]}},"markdownRemark":{"id":"8b4d2c8d-285f-5881-a76c-73a9050b6366","excerpt":"JavaScript에서도 다른 여타 언어들처럼 instance를 생성할 떄 new를 사용한다. JavaScript는 prototype으로 instance를 생성해야 하기 때문에 Java나 C…","html":"<p>JavaScript에서도 다른 여타 언어들처럼 instance를 생성할 떄 new를 사용한다. JavaScript는 prototype으로 instance를 생성해야 하기 때문에 Java나 C++같은 언어와는 다른 방식을 가지고 있다. 내부적으로 어떤식으로 동작하는지 궁금해서 검색해보다가 <a href=\"https://en.wikipedia.org/wiki/Douglas_Crockford\">Douglas Crockford</a>의 책 <em>JavaScript: The Good Parts</em>에 좋은 코드가 있어서 가져와보았다. 아래의 코드는 new가 keyword가 아니라 function이라고 가정했을 때 적어본 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">///////////////////////////////////////////////////////////</span>\n<span class=\"token comment\">// Douglas Crockford, JavaScript: The Good Parts p4, p47 //</span>\n<span class=\"token comment\">///////////////////////////////////////////////////////////</span>\n\n<span class=\"token comment\">// prototype에 주어진 function을 추가</span>\n<span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">method</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> func</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> func<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nFunction<span class=\"token punctuation\">.</span><span class=\"token function\">method</span><span class=\"token punctuation\">(</span><span class=\"token string\">'new'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 주어진 prototype을 사용하여 새로운 object를 생성한다</span>\n  <span class=\"token keyword\">var</span> that <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 생성한 object를 바인딩하여 생성자를 호출한다</span>\n  <span class=\"token keyword\">var</span> other <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>that<span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// other가 object가 아니면 that을 대신 돌려준다</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> other <span class=\"token operator\">===</span> <span class=\"token string\">'object'</span> <span class=\"token operator\">&amp;&amp;</span> other<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> that<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>object를 생성할 때 쓰인 Object.create()는 완전히 빈 object를 만들어서 거기에다가 단순히 prototype을 연결시키는 역할을 한다. 위의 line 13의 코드를 바꿔보자면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> that <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 혹은 new Object()</span>\n<span class=\"token comment\">// 숨겨진 prototype link</span>\n<span class=\"token comment\">// __proto__는 표준이 아니므로 쓰지 않는 것이 좋다</span>\nthat<span class=\"token punctuation\">.</span>__proto__ <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">;</span></code></pre></div>\n<p>이렇게 만들어진 <em>new function</em>을 이용하면 아래와 같이 new를 사용하지 않고 새로운 instance를 만들 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">Point</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x<span class=\"token punctuation\">,</span> y</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> y<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">var</span> p1 <span class=\"token operator\">=</span> Point<span class=\"token punctuation\">.</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Douglas Crockford는 <em>JavaScript: The Good Parts</em>에서 new을 사용하는 것에 대해서 부정적인 입장을 보였다. 혹시나 개발자가 실수로 new를 사용하는 것을 잊어버리면 instance생성이 아닌 일반적인 function 호출이 되어버려서 생성자 내부에서 쓰이는 this가 global로 바인딩 되어버리기 때문이다. JavaScript engine는 컴파일/런타임 때 아무런 오류를 보여주지 않기 때문에 더욱 문제가 된다. 실제로 많은 사람들이 이 문제로 많은 버그를 겪었고, ECMAScript5부터 <strong>strict mode</strong>를 지원해서 바인딩없이 function이 호출될 경우 this가 undefined로 바인딩되도록 하였다.</p>\n<p>다른 것보다도 class가 없는 JavaScript에 Java/C++와 같이 new를 사용하도록 만들었다는 것 자체가 문제라고 본다. prototype을 기반으로 한 훨씬 이해하기 쉬운 instance 생성 문법도 있었을텐데, Java랑 비슷한 문법으로 된 건 그 당시 Netscape의 정책 때문이라고 알고 있다. 열 흘만에 만들어진 언어의 숙명이랄까. 멀리 갈 것도 없이 나부터 바로 이해가 안돼서 이런 글을 쓰게 되었으니.. ES6부터는 아예 class keyword를 지원해서 훨씬 직관적으로 class를 선언하고 instance를 생성할 수 있게 되었다 — 당연하게도 prototype기반 언어인 것은 변함이 없다. <a href=\"http://www.2ality.com/\">Dr. Axel Rauschmayer</a>가 적은 글 중에 ES6의 class에 대한 좋은 글이 있는데 나중에 한 번 다뤄볼 생각이다.</p>\n<ul>\n<li>참고글:</li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create\">MDN - JavaScript Object.create()</a></li>\n<li><a href=\"http://stackoverflow.com/questions/7962886/how-does-object-create-work-in-javascript\">StackOverflow - How does Object.create work in JavaScript</a></li>\n<li>관련글: <a href=\"/javascript-prototype\">JavaScript Prototype</a></li>\n</ul>","frontmatter":{"title":"new와 prototype","category":"dev","date":"July 20, 2015","updated":null,"description":null,"tags":["JavaScript","new","prototype"]}},"previous":{"fields":{"slug":"/dev/lexical-scope-and-dynamic-scope/"},"frontmatter":{"title":"Lexical Scope and Dynamic Scope"}},"next":{"fields":{"slug":"/dev/prototype-chain/"},"frontmatter":{"title":"Prototype Chain and Property Shadowing"}}},"pageContext":{"id":"8b4d2c8d-285f-5881-a76c-73a9050b6366","previousPostId":"1a153f1a-6d60-5538-a4c4-b4408a43c397","nextPostId":"255bfca4-521e-5d07-ba19-eaa967c77cc8"}},"staticQueryHashes":["2841359383"]}